import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
import seaborn as sns

df = pd.read_csv('tmdb_5000_movies.csv')

# смотрим поля и данные
df.head()
df.shape
df.keys()

df['budget'].unique() 
# в некоторых ячейках присутствуют выбросы данных по отношении к среднему
(df['budget'] < 100).mean()
# можем увидеть почти нулевые бюджеты, что вероятно есть ошибка данных

# посмотрим на распределение бюджета
df['budget'].plot(kind='box', title='Распределение бюджета', grid=True)
# хорошо видно что в освновном бюджеты фильмов распределены в пределах до 50 млн., присутствую выбросы(большие бюджеты) начиная от 100 млн

# посмотрим топ-3 жанров по популярности
top = df[['popularity', 'genres']].groupby('genres').sum().sort_values('popularity', ascending=False).head(3)
top.plot(kind='bar', title='Топ 3 жанра по Популярность', xlabel='Жанр', ylabel='Популярность')
for i, val in enumerate(top.values):
    plt.text(i, val, int(val), horizontalalignment='center', verticalalignment='bottom', fontdict={'size':8})
# в топ 3 - Драма, Комедия, Роман

sns.regplot(data=df, y='vote_count', x='popularity', color='green', marker='+')
plt.title('Корреляция между доходом и проголосовавшими')
plt.ylim(0, 20000)
# на этом графике можем видеть корреляцию популярности и кол-ва проголосовавших

# смотрим на распределение средних оценок
sns.histplot(df['vote_average'])
plt.title('Распределение средних оценок')
# видим что большинство оцененок распределены от 4 до 8

sns.jointplot(x='budget', y='revenue', data=df, kind='reg')
# Посмотрим на то, как связаны между собой величины budget и revenue.
# тут мы можем видить что определенная зависимость дохода от бюджета существует. 

# посмотрим на различные признаки в наборе данных и выберем отдельные для изучения
sns.pairplot(df)
# посмотрим vote_count и revenue
sns.jointplot(x='vote_count', y='revenue', data=df, kind='reg')
# можем видить зависимость дохода и кол-ва оценок

# смотрим подробнее на зависимость бюджета, дохода и кол-ва проголосовавших
sns.pairplot(df[['budget', 'revenue', 'vote_count']])
# зависимость роста дохода от роста кол-ва проголосовавших намного лучше отражается на доходе
# чем от суммы бюджета

# соберем вместе числовые переменные чтобы посмотреть на их взаимную корреляцию и построим тепловую карту
df1 = df.groupby('budget')[['budget', 'popularity', 'revenue', 'vote_average', 'vote_count']].mean().corr()
sns.heatmap(data=df1, annot=True, cmap='PuBu')
# на тепловой видна зависимость между разными переменными, 
# например переменная popularity имеет меньшую корреляцию с доходом, чем кол-во проголосовавших
# также видно что зависимость популярности имеет среднюю корреляцию с суммой бюджета, при этом более сильную с доходом
